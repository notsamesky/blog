!function(){"use strict";class e{static analyze(e){for(var t=e.replace(/\r\n/g,"\n").split("\n"),a=t[1].split(","),i=t[2].split(","),s=[],o=3;o<t.length;o++){var n=t[o].split(",");if(n.length>=2){for(var r={},h=0;h<i.length;h++)if("int"==i[h]||"int64"==i[h]||"float"==i[h]||"float64"==i[h]){""==n[h]&&(n[h]="0");var l=Number(n[h]);r[a[h]]=null!=l?l:n[h]}else r[a[h]]=n[h];s.push(r)}}return s}static arrayToObject(e,t){for(var a={},i=0;i<e.length;i++){var s=e[i];s&&null!=s[t]&&(a[s[t]]=s)}return a}}var t={anonymous_openid:"",highScore:0,money:3e3,skin:[1],cur_skin:1,loginTime:"",online:0,share:0,ad:0,onlineGift:0,music:1,sound:1};function RotateLeft(e,t){return e<<t|e>>>32-t}function AddUnsigned(e,t){var a,i,s,o,n;return s=2147483648&e,o=2147483648&t,n=(1073741823&e)+(1073741823&t),(a=1073741824&e)&(i=1073741824&t)?2147483648^n^s^o:a|i?1073741824&n?3221225472^n^s^o:1073741824^n^s^o:n^s^o}function FF(e,t,a,i,s,o,n){return e=AddUnsigned(e,AddUnsigned(AddUnsigned(function(e,t,a){return e&t|~e&a}(t,a,i),s),n)),AddUnsigned(RotateLeft(e,o),t)}function GG(e,t,a,i,s,o,n){return e=AddUnsigned(e,AddUnsigned(AddUnsigned(function(e,t,a){return e&a|t&~a}(t,a,i),s),n)),AddUnsigned(RotateLeft(e,o),t)}function HH(e,t,a,i,s,o,n){return e=AddUnsigned(e,AddUnsigned(AddUnsigned(function(e,t,a){return e^t^a}(t,a,i),s),n)),AddUnsigned(RotateLeft(e,o),t)}function II(e,t,a,i,s,o,n){return e=AddUnsigned(e,AddUnsigned(AddUnsigned(function(e,t,a){return t^(e|~a)}(t,a,i),s),n)),AddUnsigned(RotateLeft(e,o),t)}function WordToHex(e){var t,a="",i="";for(t=0;t<=3;t++)a+=(i="0"+(e>>>8*t&255).toString(16)).substr(i.length-2,2);return a}var a={};a.hex_md5=function(e){var t,a,i,s,o,n,r,h,l,c=Array();for(c=function(e){for(var t,a=e.length,i=a+8,s=16*((i-i%64)/64+1),o=Array(s-1),n=0,r=0;r<a;)n=r%4*8,o[t=(r-r%4)/4]=o[t]|e.charCodeAt(r)<<n,r++;return n=r%4*8,o[t=(r-r%4)/4]=o[t]|128<<n,o[s-2]=a<<3,o[s-1]=a>>>29,o}(e=function(e){for(var t="",a=0;a<e.length;a++){var i=e.charCodeAt(a);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t}(e)),n=1732584193,r=4023233417,h=2562383102,l=271733878,t=0;t<c.length;t+=16)a=n,i=r,s=h,o=l,n=FF(n,r,h,l,c[t+0],7,3614090360),l=FF(l,n,r,h,c[t+1],12,3905402710),h=FF(h,l,n,r,c[t+2],17,606105819),r=FF(r,h,l,n,c[t+3],22,3250441966),n=FF(n,r,h,l,c[t+4],7,4118548399),l=FF(l,n,r,h,c[t+5],12,1200080426),h=FF(h,l,n,r,c[t+6],17,2821735955),r=FF(r,h,l,n,c[t+7],22,4249261313),n=FF(n,r,h,l,c[t+8],7,1770035416),l=FF(l,n,r,h,c[t+9],12,2336552879),h=FF(h,l,n,r,c[t+10],17,4294925233),r=FF(r,h,l,n,c[t+11],22,2304563134),n=FF(n,r,h,l,c[t+12],7,1804603682),l=FF(l,n,r,h,c[t+13],12,4254626195),h=FF(h,l,n,r,c[t+14],17,2792965006),n=GG(n,r=FF(r,h,l,n,c[t+15],22,1236535329),h,l,c[t+1],5,4129170786),l=GG(l,n,r,h,c[t+6],9,3225465664),h=GG(h,l,n,r,c[t+11],14,643717713),r=GG(r,h,l,n,c[t+0],20,3921069994),n=GG(n,r,h,l,c[t+5],5,3593408605),l=GG(l,n,r,h,c[t+10],9,38016083),h=GG(h,l,n,r,c[t+15],14,3634488961),r=GG(r,h,l,n,c[t+4],20,3889429448),n=GG(n,r,h,l,c[t+9],5,568446438),l=GG(l,n,r,h,c[t+14],9,3275163606),h=GG(h,l,n,r,c[t+3],14,4107603335),r=GG(r,h,l,n,c[t+8],20,1163531501),n=GG(n,r,h,l,c[t+13],5,2850285829),l=GG(l,n,r,h,c[t+2],9,4243563512),h=GG(h,l,n,r,c[t+7],14,1735328473),n=HH(n,r=GG(r,h,l,n,c[t+12],20,2368359562),h,l,c[t+5],4,4294588738),l=HH(l,n,r,h,c[t+8],11,2272392833),h=HH(h,l,n,r,c[t+11],16,1839030562),r=HH(r,h,l,n,c[t+14],23,4259657740),n=HH(n,r,h,l,c[t+1],4,2763975236),l=HH(l,n,r,h,c[t+4],11,1272893353),h=HH(h,l,n,r,c[t+7],16,4139469664),r=HH(r,h,l,n,c[t+10],23,3200236656),n=HH(n,r,h,l,c[t+13],4,681279174),l=HH(l,n,r,h,c[t+0],11,3936430074),h=HH(h,l,n,r,c[t+3],16,3572445317),r=HH(r,h,l,n,c[t+6],23,76029189),n=HH(n,r,h,l,c[t+9],4,3654602809),l=HH(l,n,r,h,c[t+12],11,3873151461),h=HH(h,l,n,r,c[t+15],16,530742520),n=II(n,r=HH(r,h,l,n,c[t+2],23,3299628645),h,l,c[t+0],6,4096336452),l=II(l,n,r,h,c[t+7],10,1126891415),h=II(h,l,n,r,c[t+14],15,2878612391),r=II(r,h,l,n,c[t+5],21,4237533241),n=II(n,r,h,l,c[t+12],6,1700485571),l=II(l,n,r,h,c[t+3],10,2399980690),h=II(h,l,n,r,c[t+10],15,4293915773),r=II(r,h,l,n,c[t+1],21,2240044497),n=II(n,r,h,l,c[t+8],6,1873313359),l=II(l,n,r,h,c[t+15],10,4264355552),h=II(h,l,n,r,c[t+6],15,2734768916),r=II(r,h,l,n,c[t+13],21,1309151649),n=II(n,r,h,l,c[t+4],6,4149444226),l=II(l,n,r,h,c[t+11],10,3174756917),h=II(h,l,n,r,c[t+2],15,718787259),r=II(r,h,l,n,c[t+9],21,3951481745),n=AddUnsigned(n,a),r=AddUnsigned(r,i),h=AddUnsigned(h,s),l=AddUnsigned(l,o);return(WordToHex(n)+WordToHex(r)+WordToHex(h)+WordToHex(l)).toLowerCase()};var i=new class{constructor(){this.GAME_ID=2,this.SIGN="51c186a5da4e8afa419f2b5d50ac87e7"}postDataFormat(e){var t="",a=!0;for(var i in e){var s=i,o=e[s];a?(t+=s+"="+o,a=!1):t+="&"+s+"="+o}return t}Test_query(){var e="avatar=https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJQymLjGGvOYcqQHJ0G0RzVkJiavMG0lBPGCTWOPmbKfBI12ZGnKAEjHz03E3xTY1YBTRZUZoGeaSA/132&game_id=3&name=考拉&score1=667588486396ca454c5f7f1c470a1074d";console.log(e);var t=a.hex_md5(e);console.log(t),console.log(t)}build_query_noencode(e,t){for(var i=(o=e[0])+"="+t[o],s=1;s<e.length;s++){var o;i+="&"+(o=e[s])+"="+t[o]}i+=this.SIGN,console.log(i);var n=a.hex_md5(i);return console.log(n),n}post(e){e.url;var t=e.data;console.log(t),e.success;var a=e.fail;a()}};class s{constructor(){}init(){}login(e){if(Laya.Browser.onAndroid){var t=12305;e.success({uid:"android_"+t})}else if(Laya.Browser.onIOS){t=12306;e.success({uid:"ios_"+t})}else e.success({uid:"web_12307"})}checkLogin(e){e.doNext()}initGG(e){}showGG(e){this.isGGTimes()?e.success():e.fail("广告准备中")}hasGG(){return!0}isGGTimes(){return!1}GetPlatform(){return"Test"}setRank(e){i.post({url:"/xgame/users/update/"+e.userId,data:{score1:e.score,name:"id_"+e.userId,avatar:"this.USER_INFO.avatarUrl"},success(e){console.log(e),JSON.parse(e).status},fail(e,t){}})}showFriendRankList(){}hideFriendRankList(){}authorize(e){e.success()}isLogin(){return!0}isAuth(){return!0}GetUIDname(){return""}GetUIDAvatarUrl(){return""}}var o=new class{constructor(){"undefined"!=typeof tt?this.SDKInterface=new s:"undefined"!=typeof wx?console.log(" i am wx GameUI !!!"):(console.log(" not mini game !!!"),this.SDKInterface=new s)}init(){this.SDKInterface.init()}login(e,t){this.SDKInterface.login({success:function(a){e.call(t,a.uid)},fail:function(e){},obj:this})}checkLogin(e){this.SDKInterface.checkLogin(e)}initGG(e){this.SDKInterface.initGG(e)}showGG(e){this.SDKInterface.showGG(e)}recordable(){return!!this.SDKInterface.stopRecord&&(console.log(" stopRecord "),!0)}stopRecord(){return!!this.SDKInterface.stopRecord&&this.SDKInterface.stopRecord()}startRecord(){this.SDKInterface.startRecord&&this.SDKInterface.startRecord()}marvellous(e){this.SDKInterface.marvellous&&this.SDKInterface.marvellous(e)}recordEndCheckReward(e){this.SDKInterface.recordEndCheckReward&&this.SDKInterface.recordEndCheckReward(e)}shareVideo(e,t){return!!this.SDKInterface.shareVideo&&this.SDKInterface.shareVideo(e,t)}vibrate(){this.SDKInterface.vibrate&&this.SDKInterface.vibrate()}vibrateLong(){this.SDKInterface.vibrateLong&&this.SDKInterface.vibrateLong()}Adable(){return this.SDKInterface.hasGG()}isAdTimes(){return this.SDKInterface.isGGTimes()}getPlatform(){return this.SDKInterface.GetPlatform()}authorize(e){return this.SDKInterface.authorize(e)}isLogin(){return this.SDKInterface.isLogin()}isAuth(){return this.SDKInterface.isAuth()}setRank(e){this.SDKInterface.setRank(e)}showFriendRankList(e){this.SDKInterface.showFriendRankList(e)}hideFriendRankList(e){this.SDKInterface.hideFriendRankList(e)}getUIDname(){return this.SDKInterface.GetUIDname()}getUIDAvatarUrl(){return this.SDKInterface.GetUIDAvatarUrl()}inviteable(){return!!this.SDKInterface.InviteFriend}inviteFriend(e){return!!this.SDKInterface.InviteFriend&&(this.SDKInterface.InviteFriend(e),!0)}};class n{static dateFormat(e,t){let a,i={"Y+":t.getFullYear().toString(),"m+":(t.getMonth()+1).toString(),"d+":t.getDate().toString(),"H+":t.getHours().toString(),"M+":t.getMinutes().toString(),"S+":t.getSeconds().toString()};for(let t in i)(a=new RegExp("("+t+")").exec(e))&&(e=e.replace(a[1],1==a[1].length?i[t]:i[t].padStart(a[1].length,"0")));return e}static timestamp(){var e=(new Date).getTime();return Math.floor(e/1e3)}static format(e){return n.dateFormat("Y-m-d HH:MM:SS",e)}static formatDay(e){return n.dateFormat("Y-m-d",e)}static formatMinSecond(e){return n.dateFormat("MM:SS",new Date(1e3*e))}static nextDayTimestamp(e){return 86400*(Math.floor(e/86400)+1)}}var r=new class{constructor(){this._loaded=!1,this.tmpData={},this.timestamp=0,this.delay=0,this.nextDayTime=0}isLogin(){return o.isLogin()}isAuth(){return o.isAuth()}getTimestampDelay(){return this.delay}getNextDaySecond(){n.timestamp(),this.delay;this.nextDayTime}clacDailyRefresh(){if(!(this.timestamp<=0)){var e=n.formatDay(new Date(1e3*this.timestamp)),a=t.loginTime;console.log(e,a),e!=a&&(t.loginTime=e,t.online=0,t.share=0,t.ad=0,t.onlineGift=0,this.save());var i=n.timestamp();this.delay=this.timestamp-i,this.nextDayTime=n.nextDayTimestamp(this.timestamp)}}updateData(e){for(var a in t)null!=e[a]&&null!=e[a]&&(t[a]=e[a])}loadData(e){this.tmpData=e;var t=e.user;this.userId=t.id;for(var a=e.histories,i=0;i<a.length;i++){var s=a[i];"gameData"==s.history_key&&(e=JSON.parse(s.history_content),this.updateData(e),console.log(e))}Laya.stage.event("login_done"),this.loaded=!0,this.syncTimestamp()}login(){o.login(function(e){this.uid=e,console.log(" uid "+e),this.getUserData()},this)}checkLogin(e){var a=this;o.checkLogin({updateUserId(e){var i=a.uid;a.uid=e,t.uid=e,t.anonymous_openid=i,a.save(),a.loaded=!0},doNext(t){e&&e(t),a.isLogin()}})}syncTimestamp(){console.log("getTimestamp");var e=this;i.post({url:"/xgame/tools/timestamp",data:{},success(t){console.log(t);var a=JSON.parse(t);a&&(console.log(a),e.timestamp=a.timestamp,e.clacDailyRefresh())},fail(e,t){}})}createNewUser(){console.log("在新服务器创建用户");var e=this;i.post({url:"/xgame/users/create",data:{uid_in_platform:e.uid,platform:o.getPlatform()},success(t){console.log(t);var a=JSON.parse(t);0==a.status?(e.id=a.id,this.userId=a.id,console.log("存储玩家数据"),e.save(),e.loaded=!0):(console.log(a.error),console.log(a.data))},fail(e,t){}})}getUserData(){var e=this;console.log("检查新服务器是否有数据"),i.post({url:"/xgame/users/get",data:{uid_in_platform:this.uid,platform:o.getPlatform()},success(t){var a=JSON.parse(t);console.log(a),a.user?(console.log("加载新服务器数据"),e.loadData(a)):e.createNewUser()},fail(e,t){}})}initGG(e){o.initGG(e)}updateRankInfo(){if(o.isAuth()){if(this.tmpData.user&&null!=this.tmpData.user&&this.tmpData.user.score1&&null!=this.tmpData.user.score1&&this.tmpData.user.score1>=t.highScore)return;var e={};e.userId=this.userId,e.score=t.highScore,o.setRank(e)}}requsetRankList(e,t,a){t=t.bind(a),i.post({url:"/xgame/users/rank/"+this.userId,data:{limit_platform:!0,rank_by:"score1",page_size:50,page:e||0},success(e){var a=JSON.parse(e);console.log(a),a.users,a.me,t(a)},fail(e,t){console.log("status "+t),console.log("response "+e)}})}save(){var e=JSON.stringify(t);i.post({url:"/xgame/users/history/"+this.userId,data:{history_key:"gameData",history_content:e},success(e){console.log(e),0==JSON.parse(e).status?console.log("save gameData success"):console.log("save gameData fail")},fail(e,t){}})}authorize(e){var t=this;o.authorize({success(){t.updateRankInfo(),null!=e&&null!=e&&e(!0),console.log("authorize success")},fail(){Laya.stage.event("tips","授权失败"),console.log("authorize fail")}})}};var h=new class{constructor(){this.config={},this.cur_score=0,this.userData=t}getConfigForKey(e){return this.config[e]}setConfigForKey(e,t){this.config[e]=t}addScore(){return this.cur_score++,this.setHighScore(this.cur_score),this.cur_score}cleanScore(){return this.cur_score=0,this.cur_score}setHighScore(e){e>this.userData.highScore&&(this.userData.highScore=e)}getMoney(){return this.userData.money}addMoney(e){return null!=e?this.userData.money+=e:this.userData.money++,Laya.stage.event("update_money"),this.userData.money}payMoney(e,t=!0){return this.userData.money>=e&&(this.userData.money-=e,t&&this.save(),Laya.stage.event("update_money"),!0)}buySkin(e,t){return this.payMoney(t,!1)?(this.userData.skin.push(e),this.save(),!0):(Laya.stage.event("tips","金币不足"),!1)}useSkin(e){for(var t=0;t<this.userData.skin.length;t++)if(this.userData.skin[t]==e){this.userData.cur_skin=e,this.save();break}}setMusicOn(e){e?(this.userData.music=1,this.playMusic("bgm.mp3")):(this.userData.music=0,Laya.SoundManager.stopMusic())}setSoundOn(e){this.userData.sound=e?1:0}playMusic(e){this.userData.music>0&&Laya.SoundManager.playMusic("res/sound/"+e)}playSound(e){this.userData.sound>0&&Laya.SoundManager.playSound("res/sound/"+e)}save(e=!1){r.save(),e&&(console.log(" save updateRankInfo !!!!!! "),r.updateRankInfo())}};let l="scenes/";class c extends Laya.Script{constructor(){super(),this.videoShow=o.Adable()}onAwake(){this.owner.width=Laya.stage.width,this.owner.height=Laya.stage.height,this.owner.event(Laya.Event.RESIZE),Laya.stage.on("update_money",this,this.updateMoney),this.freeBtn.on(Laya.Event.CLICK,this,this.free),this.playBtn.on(Laya.Event.CLICK,this,this.play),this.videoBtn.on(Laya.Event.CLICK,this,this.video),this.shareBtn.on(Laya.Event.CLICK,this,this.share),this.shareBtn.visible=o.inviteable(),this.helpBtn.on(Laya.Event.CLICK,this,this.help),this.leaderboardBtn.on(Laya.Event.CLICK,this,this.leaderboard),this.shopBtn.on(Laya.Event.CLICK,this,this.shop),this.scoreText.text=h.cur_score,this.highText.text=t.highScore,this.moneyText.text=t.money,h.save(!0),Laya.loader.load("res/config/brick_gift.csv",Laya.Handler.create(this,function(t){this.config_gift=e.analyze(t),h.setConfigForKey("brick_gift",this.config_gift),this.showGift()})),Laya.timer.loop(500,this,this.onTimerLoop)}updateMoney(){this.moneyText.text=h.getMoney()+""}play(){console.log(" play play "),Laya.stage.event("new_game"),this.owner.destroy()}free(){console.log(" free free ");var e=this.config_gift[t.onlineGift];if(e){t.online=0,t.onlineGift=e.id;var a=Math.floor(Math.random()*(e.maxCoin-e.minCoin))+e.minCoin;Laya.stage.event("get_money",a),this.showGift()}}video(){console.log(" video video ")}share(){console.log(" share share "),Laya.stage.event("get_money",100),this.shareBtn.disabled=!0,this.showGift()}help(){console.log(" help help "),Laya.Scene.load(l+"help.json",Laya.Handler.create(this,function(e){this.rootNode.addChild(e),e.zOrder=3}))}leaderboard(){console.log(" leaderboard leaderboard "),Laya.Scene.load(l+"TOP.json",Laya.Handler.create(this,function(e){this.rootNode.addChild(e),e.zOrder=3}))}shop(){console.log(" shop shop "),Laya.Scene.load(l+"shop.json",Laya.Handler.create(this,function(e){this.rootNode.addChild(e),e.zOrder=3}))}showGift(e=!1){var a=this.config_gift[t.onlineGift];this.giftNode.visible=!1,this.videoNode.visible=!1,this.timerNode.visible=!1,a&&(t.online>=a.time?this.giftNode.visible=!0:this.videoShow&&(this.timerNode.visible=!0,e||this.onTimerLoop())),this.videoShow||(this.videoNode.visible=!1)}onTimerLoop(){if(this.timerNode.visible){var e=this.config_gift[t.onlineGift];if(e){var a=e.time-t.online;a<0?(a=0,this.showGift(!0)):this.timerText.text=n.formatMinSecond(a)}}}}class d extends Laya.Script3D{constructor(){super()}onAwake(){this.playAnim()}playAnim(){this.owner.timerOnce(500,this,this.onRemove)}onRemove(){this.owner.destroy()}}class y extends Laya.Script3D{constructor(){super(),this.line=0}onAwake(){this.owner.timerOnce(1e3,this,this.remove),this.owner.getComponent(Laya.Rigidbody3D).linearVelocity=new Laya.Vector3(0,0,60)}setLine(e){this.line=e}shot(){this.owner.getComponent(Laya.Rigidbody3D).linearVelocity=new Laya.Vector3(0,0,60)}remove(){this.owner.destroy()}onTriggerEnter(e){if(e&&e.owner&&"block"==e.owner.name){var t=this.line;Laya.stage.event("put_block",t),this.remove()}}}let g={Release:0,Press:1},u={Loading:-1,GameOver:0,Ready:1,Play:2,Pause:3},f=4,m=1.5,L=.1,v=-10,p="res/scenes3D/LayaScene_SampleScene/Conventional/",k="res/scenes3D/LayaScene_ef_hit_01/Conventional/";class _ extends Laya.Script{constructor(){super(),this.block_perfab={},this.line_root=[],this.block_array=[],this.bullet_array=[],this.speed=m,this.group_count=0,this.touchPoint={},this.prevBlockType=0,this.empty_seat=-1,this.emptyCount=0,this.skill=0,this.skillPoint=0,this.skillRange=0,this.vibrateCount=0,this.skin=t.cur_skin,this.point=new Laya.Vector2,this.mouseState=g.Release,this.GameState=u.Loading,Laya.loader.load("res/config/bomb.csv",Laya.Handler.create(this,function(t){this.skill_config=e.analyze(t),h.setConfigForKey("skill",this.skill_config)})),Laya.loader.load("res/config/brick.csv",Laya.Handler.create(this,function(t){this.config=e.analyze(t),h.setConfigForKey("brick",this.config)})),Laya.loader.load("res/config/brick_skin.csv",Laya.Handler.create(this,function(t){this.skin_config=e.analyze(t),h.setConfigForKey("brick_skin",this.skin_config);for(var a=[],i=0;i<this.skin_config.length;i++)1==this.skin_config[i].type&&a.push(k+this.skin_config[i].flyRes+".lh");Laya.loader.create(a,Laya.Handler.create(this,function(e){for(var t=0;t<this.skin_config.length;t++)1==this.skin_config[t].type&&(this.block_perfab[this.skin_config[t].flyRes]=Laya.loader.getRes(k+this.skin_config[t].flyRes+".lh"))}))}))}onAwake(){this.owner.width=Laya.stage.width,this.owner.height=Laya.stage.height,this.owner.event(Laya.Event.RESIZE),Laya.stage.on("put_block",this,this.putBlock),Laya.stage.on("pause",this,this.pause),Laya.stage.on("speed_end",this,this.speedEnd),Laya.stage.on("revival",this,this.revival),Laya.stage.on("new_game",this,this.newGame),Laya.stage.on("change_skin",this,this.changeSkin),Laya.stage.on("send_ready",this,this.sendReady),Laya.Scene3D.load(p+"SampleScene.ls",Laya.Handler.create(this,this.onLoadSceneCmp))}initTouch(){this.touchPanel.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown),this.touchPanel.on(Laya.Event.MOUSE_MOVE,this,this.onMouseMove),this.touchPanel.on(Laya.Event.MOUSE_UP,this,this.onMouseUp)}changeSkin(){this.skin=t.cur_skin}onCsv(t){this.config=e.analyze(t)}onLoadSceneCmp(e){this.scenes3D=e,Laya.stage.addChild(e),e.zOrder=-1,this.road=e.getChildByName("road"),this.root_object=e.getChildByName("root_object"),this.rigid=this.root_object.getComponent(Laya.Rigidbody3D),this.mainCamera=e.getChildByName("MainCamera"),this.mainCamera.fieldOfView=20/1560*Laya.stage.height;for(var t=0;t<f;t++)this.line_root[t]=e.getChildByName("line_"+t);Laya.loader.create([p+"huang.lh",p+"hei.lh",p+"hong.lh",p+"hui.lh",p+"hui2.lh",p+"jinbi.lh",p+"zhadan.lh",k+"zk_ef_hit_01.lh",k+"zk_ef_hit_02.lh",k+"zk_ef_hit_03.lh",k+"zk_ef_hit_04.lh"],Laya.Handler.create(this,this.startBlock))}vibrate(){this.vibrateCount=0,Laya.timer.loop(17,this,this.doVibrate)}doVibrate(){var e=[-.1,-.1,.1,.1,.1,.1,-.1,-.1];this.mainCamera.transform.translate(new Laya.Vector3(e[this.vibrateCount],0,0)),this.vibrateCount++,this.vibrateCount>=e.length&&(this.vibrateCount=0,Laya.timer.clear(this,this.doVibrate))}removeGroup(e,t){(null==t||t<1)&&(t=1);for(var a=!0,i=f-1;i>=0;i--)e[i]&&null!=e[i]&&(e[i].hp-=t,e[i].hp<=0?(null!=e[i].destroy&&(this.checkCoin(e[i]),this.createParticle(e[i]),e[i].removeSelf(),Laya.Pool.recover(e[i].res_name,e[i])),e[i]=null):(e[i].meshRenderer&&(e[i].meshRenderer.material=this.break_material),a=!1));return a}checkGroup(e){for(var t=!0,a=0;a<f;a++)if(null==e[a]||null==e[a]){t=!1;break}return t}cleanLongBlock(e){if(!(e<=0||this.checkGroup(this.block_array[e-1]))){for(var t=-1,a=0;a<f;a++)if(null!=this.block_array[e][a]&&null!=this.block_array[e][a]&&this.block_array[e][a].bsize>=2){t=a;break}t>=0&&(this.block_array[e-1][t]=void 0)}}checkPoison(e){if(!(e<=0)){for(var t=1,a=0;a<f;a++)if(this.block_array[e][a].range>=2){t=this.block_array[e][a].range;break}return Math.min(e+1,t)}}pushFirstArrary(e){this.block_array.unshift(e)}removeArray(){var e=1,t=0;this.skillRange>0&&(t=1,e=2,this.skillRange-=1);for(var a=this.block_array.length-1;a>=0;a--){var i=this.block_array[a];if(i){var s=this.checkGroup(i);if(s||t>0){if(s&&(t=Math.max(t,this.checkPoison(a)))>=2&&(e=2),t--,this.cleanLongBlock(a),this.removeGroup(i,e)){this.block_array.pop(),this.addScore(),t>0&&(this.skillRange=t);break}this.cleanTouch();break}break}}}cleanTouch(){this.touchPoint={}}setSpeed(e){this.rigid.linearVelocity=new Laya.Vector3(0,0,0-e)}getFirstPosZ(){var e=this.block_array.length;if(e<=0)return 0;for(var t=this.block_array[e-1],a=null,i=0;i<f;i++)null!=t[i]&&null!=t[i]&&t[i].transform&&(a=t[i].transform.position);return a.z}startBlock(e){this.block_perfab.huang=Laya.loader.getRes(p+"huang.lh"),this.block_perfab.hei=Laya.loader.getRes(p+"hei.lh"),this.block_perfab.hong=Laya.loader.getRes(p+"hong.lh"),this.block_perfab.hui=Laya.loader.getRes(p+"hui.lh"),this.block_perfab.hui2=Laya.loader.getRes(p+"hui2.lh"),this.block_perfab.jinbi=Laya.loader.getRes(p+"jinbi.lh"),this.block_perfab.zhadan=Laya.loader.getRes(p+"zhadan.lh"),this.block_perfab.zk_ef_hit_01=Laya.loader.getRes(k+"zk_ef_hit_01.lh"),this.block_perfab.zk_ef_hit_02=Laya.loader.getRes(k+"zk_ef_hit_02.lh"),this.block_perfab.zk_ef_hit_03=Laya.loader.getRes(k+"zk_ef_hit_03.lh"),this.block_perfab.zk_ef_hit_04=Laya.loader.getRes(k+"zk_ef_hit_04.lh"),this.break_material=this.block_perfab.hui2.meshRenderer.material,this.newGame(),Laya.timer.frameLoop(1,this,this.onFrameLoop),Laya.timer.frameLoop(1,this,this.onFrame2Loop),this.initTouch()}createBullet(e){var t=this.skin_config[this.skin];if(null!=this.block_perfab[t.flyRes]&&null!=this.block_perfab[t.flyRes]){var a=this.line_root[e].addChild(Laya.Sprite3D.instantiate(this.block_perfab[t.flyRes],null,!1,new Laya.Vector3(0,.3,-9+v)));a.transform.setWorldLossyScale(new Laya.Vector3(.9,.9,.9)),a.name="bullet",a.addComponent(y),a.getComponent(y).setLine(e)}}createParticle(e){if(e&&e.btype>=0){var t=this.config[0],a=e.transform.position;a.y+=.1;var i=this.scenes3D.addChild(Laya.Sprite3D.instantiate(this.block_perfab[t.effect],null,!1,a));i.name="particle",i.addComponent(d)}}createPoolBlock(e){var t=Laya.Sprite3D.instantiate(this.block_perfab[this.cur_block_res],null,!1);return t.name="block",t}createBlock(e,t,a){null==a&&(a=0);var i=this.config[a],s=this.block_perfab[i.res].transform.position;this.cur_block_res=i.res;var o=Laya.Pool.getItemByCreateFun(i.res,this.createPoolBlock,this);return o.transform.position=new Laya.Vector3(1.5-e%4*1+s.x,0+s.y,12+.8*t+s.z),o.transform.setWorldLossyScale(new Laya.Vector3(.9,.9,.9)),o.btype=a,o.res_name=i.res,o.bsize=i.bsize,o.hp=i.hp,o.range=i.num,o.coin=0,this.root_object.addChild(o),o}createBomb(e){var t=e.addChild(Laya.Sprite3D.instantiate(this.block_perfab.zhadan));return e.bomb=1,e.range=4,t}createPoolCoin(){var e=Laya.Sprite3D.instantiate(this.block_perfab.jinbi);return e.name="coin",e}createCoin(e){var t=Laya.Pool.getItemByCreateFun("jinbi",this.createPoolCoin,this);return e.addChild(t),e.coin=1,t}checkCoin(e){if(e&&e.coin){e.coin=0;var t=e.getChildByName("coin");t.removeSelf(),Laya.Pool.recover("jinbi",t),h.playSound("coin.wav"),Laya.stage.event("add_money")}}randomBlock(){for(var e=0,t=0,a=[],i=[],s=0,o=0;o<this.config.length;o++)this.config[o].appearLayer<=this.group_count&&(0!=o&&this.prevBlockType==o||(i[s]=o,t+=this.config[o].weight,a[s]=t,s++));var n=Math.floor(Math.random()*t),r=0,h=0;for(o=0;o<a.length;o++){if(h=a[o],r<=n&&h>n){e=i[o];break}r=h}return this.prevBlockType=e,e}randomBomb(e){var t=-1;if(Math.floor(1e4*Math.random())<100){for(var a=0,i=[],s=0;s<e.length;s++)0==e[s]&&(i[a]=s,a++);t=i[Math.floor(Math.random()*i.length)]}return t}randomCoin(e){var t=-1;if(Math.floor(1e4*Math.random())<4e3){for(var a=0,i=[],s=0;s<e.length;s++)0==e[s]&&(i[a]=s,a++);t=i[Math.floor(Math.random()*i.length)]}return t}createLineBlock(){this.group_count++;for(var e=[],t=this.block_array[0],a=this.randomBlock(),i=[0,0,0,0],s=0,o=0;o<f;o++)this.emptyCount>=4&&o==this.empty_seat?i[o]=-2:t&&t[o]&&null!=t[o]&&2==t[o].bsize?(e[o]={},e[o].bsize=1,e[o].hp=1,i[o]=-1):(s++,i[o]=0);var n=Math.floor(Math.random()*s),r=0,h=-1;for(o=0;o<i.length;o++)if(0==i[o]){if(r==n){i[o]=-1,h=o;break}r++}if(this.empty_seat==h?this.emptyCount++:(this.emptyCount=1,this.empty_seat=h),"hong"==this.config[a].res){r=0;for(o=0;o<i.length;o++)-2==i[o]&&(i[o]=0),0==i[o]&&r++;n=Math.floor(Math.random()*r);r=0;for(o=0;o<i.length;o++)0==i[o]&&(n==r&&(i[o]=a),r++)}else for(o=0;o<i.length;o++)0!=i[o]&&-2!=i[o]||(i[o]=a);var l=this.randomCoin(i),c=this.randomBomb(i);for(o=0;o<i.length;o++)i[o]>=0&&(e[o]=this.createBlock(o,this.group_count,i[o]),c==o&&0==i[o]||l==o&&0==i[o]&&this.createCoin(e[o]));this.pushFirstArrary(e)}putBlock(e){var t=this.block_array.length,a=this.block_array[t-1];if(!a||null!=a[e]&&null!=a[e]){var i=[];i[e]=this.createBlock(e,this.group_count-t,0),this.block_array[t]=i,this.useSkill()}else{for(var s=null,o=null,n=t-1;n>=0&&((o=this.block_array[n])&&(null==o[e]||null==o[e]));n--)s=n;if(null==s)return;o&&(this.block_array[s][e]=this.createBlock(e,this.group_count-s,0))}}addScore(){h.playSound("hit.wav"),this.skillPoint++,this.skill_config&&this.skill_config[this.skill]&&this.skillPoint>=this.skill_config[this.skill].num&&(this.skillPoint=0,this.skill++),Laya.stage.event("add_score")}useSkill(){this.skill_config&&this.skill_config[this.skill-1]&&(this.skillRange=this.skill_config[this.skill-1].dispel),this.skill=0,this.skillPoint=0,Laya.stage.event("clean_skill")}shot(){for(var e=[],t=-1,a=0;a<f;a++){if(!(this.bullet_array.length>0))break;t=this.bullet_array[0];for(var i=0;i<e.length;i++)if(e[i]==t)return;this.createBullet(t),this.bullet_array.shift(),e[e.length]=t}}getMoreBlock(e){var t=this.block_array.length,a=this.block_array[t-1];if(a&&(null==a[e]||null==a[e])){for(var i=null,s=t-1;s>=0;s--){var o=this.block_array[s];if(!o||null!=o[e]&&null!=o[e])break;i=s}if(null==i)return 1;var n=t-i;for(s=0;s<this.bullet_array.length;s++)this.bullet_array[s]==e&&n--;return Math.max(0,n-this.line_root[e].numChildren)}return 0}newGame(){this.GameState=u.gameOver,this.root_object.transform.position=new Laya.Vector3(0,0,-12+v),this.root_object.destroyChildren(),this.rigid.linearVelocity=new Laya.Vector3(0,0,-10);var e=this.mainCamera.transform.position;e.x=0,this.mainCamera.transform.position=e,this.block_array=[],this.bullet_array=[],this.speed=m,this.group_count=0,this.touchLine=0,this.empty_seat=-1,this.emptyCount=0,this.skill=0,this.skillPoint=0,this.skillRange=0,this.vibrateCount=0;for(var t=0;t<10;t++)this.createLineBlock();Laya.timer.once(500,this,this.readyTime)}gameOver(){this.GameState=u.GameOver,this.bullet_array=[];for(var e=0;e<f;e++)this.line_root[e].destroyChildren();this.rigid.linearVelocity=new Laya.Vector3(0,0,0),h.playSound("lost.wav"),Laya.stage.event("game_over"),this.vibrate()}revival(){this.GameState==u.GameOver&&(this.rigid.linearVelocity=new Laya.Vector3(0,0,14),Laya.timer.loop(17,this,this.revivalBackTime))}sendReady(){if(this.GameState!=u.GameOver){for(var e=1,t=0,a=0;a<f;a++){var i=this.getMoreBlock(a);t<i&&(t=i,e=a)}var s=Laya.stage.width/f,o={};o.x=e*s+s/2,o.y=.8*Laya.stage.height,o.num=t,Laya.stage.event("game_ready",o)}}readyTime(){this.rigid.linearVelocity=new Laya.Vector3(0,0,0),this.GameState=u.ready,this.sendReady()}revivalBackTime(){this.getFirstPosZ()>=-1.5+v&&(Laya.timer.clear(this,this.revivalBackTime),this.readyTime())}play(){this.GameState!=u.Loading&&this.GameState!=u.Play&&this.GameState!=u.GameOver&&(Laya.stage.event("play"),this.GameState=u.Play,this.setSpeed(this.speed))}pause(){this.GameState=u.Pause,this.rigid.linearVelocity=new Laya.Vector3(0,0,0)}speedEnd(){this.setSpeed(this.speed)}onMouseDown(e){if(this.GameState!=u.Play&&this.GameState!=u.GameOver&&this.play(),this.GameState==u.Play){this.mouseState=g.Press;var t={};t.x=Laya.stage.mouseX,t.y=Laya.stage.mouseY,t.line=Math.floor(t.x/(Laya.stage.width/f)),this.touchPoint[e.touchId]=t,this.skillRange>0||this.bullet_array.push(t.line)}}onMouseMove(e){var t=this.touchPoint[e.touchId];if(t&&null!=t&&t.y-Laya.stage.mouseY>=15){var a=this.getMoreBlock(t.line);if(a>0){if(this.skillRange>0);else for(var i=0;i<a;i++)this.bullet_array.push(t.line);delete this.touchPoint[e.touchId]}}}onMouseUp(e){this.mouseState=g.Release,this.touchPoint[e.touchId]&&null!=this.touchPoint[e.touchId]&&delete this.touchPoint[e.touchId]}onFrameLoop(){if(this.GameState==u.Play){Laya.timer.delta;this.removeArray(),this.block_array.length<13&&this.createLineBlock();var e=this.getFirstPosZ(),t=Math.floor(this.group_count/25)*L;t>5&&(t=5),e<=-8.5+v?this.gameOver():e>=-1+v?this.setSpeed(6+this.speed+t):this.setSpeed(this.speed+t)}}onFrame2Loop(){this.GameState==u.Play&&this.shot()}}let b="scenes/",S="res/scenes3D/LayaScene_SampleScene/Conventional/",w="res/scenes3D/LayaScene_ef_hit_01/Conventional/";class C extends Laya.Script{constructor(){super(),this.revival=0,this.skill=0,this.skillPercent=0,this.curTime=n.timestamp(),Laya.stage.on("add_score",this,this.addScore),Laya.stage.on("add_money",this,this.addMoney),Laya.stage.on("update_money",this,this.updateMoney),Laya.stage.on("clean_skill",this,this.cleanSkill),Laya.stage.on("game_over",this,this.gameOver),Laya.stage.on("new_game",this,this.newGame),Laya.stage.on("play",this,this.play),Laya.stage.on("share_done",this,this.shareEnd),Laya.stage.on("get_money",this,this.getMoney),Laya.stage.on("login_done",this,this.loginDone),Laya.stage.on("tips",this,this.tips),Laya.loader.load(["res/atlas/amin.atlas","res/atlas/amin.png"],Laya.Handler.create(this,function(){})),Laya.Scene.load(b+"Game.json",Laya.Handler.create(this,this.onLoadScene)),Laya.loader.create([S+"huang.lh",S+"hei.lh",S+"hong.lh",S+"hui.lh",S+"hui2.lh",S+"jinbi.lh",S+"zhadan.lh",w+"zk_ef_hit_01.lh",w+"zk_ef_hit_02.lh",w+"zk_ef_hit_03.lh",w+"zk_ef_hit_04.lh"],Laya.Handler.create(this,function(){}))}onAwake(){this.owner.width=Laya.stage.width,this.owner.height=Laya.stage.height,this.owner.event(Laya.Event.RESIZE),this.pauseBtn.on(Laya.Event.CLICK,this,this.pause),this.cleanSkill(),this.cleanScore(),Laya.timer.loop(500,this,this.onTimerLoop)}onLoadScene(e){this.rootNode.addChild(e),e.zOrder=-1,Laya.Scene.load(b+"PauseUI.json",Laya.Handler.create(this,function(e){this.rootNode.addChild(e),e.zOrder=3})),h.playMusic("bgm.mp3")}loginDone(){this.moneyText.text=h.getMoney()+""}addEnergy(){var e=h.getConfigForKey("skill");e&&e[this.skill]&&(this.skillPercent+=1/e[this.skill].num,this.skillPercent>=1&&(this.skill+=1,this.skillPercent=0),this.skillText.text="x"+this.skill,this.skillProgress1.value=this.skillPercent,this.skillProgress2.value=this.skillPercent)}cleanSkill(){this.skill=0,this.skillPercent=0,this.skillText.text="x"+this.skill,this.skillProgress1.value=this.skillPercent,this.skillProgress2.value=this.skillPercent}addScore(){this.addEnergy(),this.scoreText.text=h.addScore()}cleanScore(){this.scoreText.text=h.cleanScore()+"",this.moneyText.text=h.addMoney(0)+""}addMoney(){this.moneyText.text=h.addMoney()+""}updateMoney(){this.moneyText.text=h.getMoney()+""}newGame(){this.revival=0,this.cleanScore(),this.cleanSkill(),Laya.Scene.load(b+"PauseUI.json",Laya.Handler.create(this,function(e){this.rootNode.addChild(e),e.zOrder=3}))}play(){t.share<5&&o.recordable()&&(this.recNode.visible=!0,o.startRecord())}pause(){Laya.stage.event("pause"),Laya.Scene.load(b+"PauseUI.json",Laya.Handler.create(this,function(e){this.rootNode.addChild(e),e.zOrder=3,Laya.stage.event("send_ready")}))}gameOver(){o.vibrateLong(),this.owner.timerOnce(200,this,this.delayGameOver)}delayGameOver(){this.revival<=0?Laya.Scene.load(b+"resurgence.json",Laya.Handler.create(this,function(e){this.rootNode.addChild(e),e.zOrder=4,this.revival=1})):(this.recNode.visible=!1,t.share<5&&o.stopRecord()?Laya.Scene.load(b+"share.json",Laya.Handler.create(this,function(e){this.rootNode.addChild(e),e.zOrder=4})):this.shareEnd(!1))}shareEnd(e){Laya.Scene.load(b+"Clearing.json",Laya.Handler.create(this,function(e){this.rootNode.addChild(e),e.zOrder=4}))}getMoney(e){Laya.Scene.load(b+"get_money_small.json",Laya.Handler.create(this,function(t){this.rootNode.addChild(t),t.zOrder=10,t.getComponent(Laya.Script).setMoney(e),h.addMoney(e),h.save()}))}tips(e){Laya.Scene.load(b+"hint_message_01.json",Laya.Handler.create(this,function(t){this.rootNode.addChild(t),t.zOrder=11,t.getComponent(Laya.Script).setTips(e)}))}onTimerLoop(){var e=n.timestamp();e>this.curTime&&(this.curTime=e,t.online++,r.getNextDaySecond())}}let I="scenes/";class D extends Laya.Script{constructor(){super(),this.tl=null}onAwake(){this.owner.width=Laya.stage.width,this.owner.height=Laya.stage.height,this.owner.event(Laya.Event.RESIZE),Laya.stage.on("play",this,this.play),Laya.stage.on("game_ready",this,this.ready),this.helpBtn.on(Laya.Event.CLICK,this,this.help),this.leaderboardBtn.on(Laya.Event.CLICK,this,this.leaderboard),this.shopBtn.on(Laya.Event.CLICK,this,this.shop)}play(){console.log(" play play "),this.owner.destroy()}ready(e){this.tl&&(this.tl.destroy(),this.tl=null),this.tl=new Laya.Animation,e.num>1?this.tl.loadAnimation(I+"anim_guide_02.ani"):this.tl.loadAnimation(I+"anim_guide_01.ani"),this.rootNode.addChild(this.tl),this.tl.x=e.x,this.tl.y=e.y,this.tl.play(),this.aniNode.visible=!0}help(){console.log(" help help "),Laya.Scene.load(I+"help.json",Laya.Handler.create(this,function(e){this.rootNode.addChild(e),e.zOrder=3}))}leaderboard(){console.log(" leaderboard leaderboard ");Laya.Scene.load(I+"TOP.json",Laya.Handler.create(this,function(e){this.rootNode.addChild(e),e.zOrder=3}))}shop(){console.log(" shop shop "),Laya.Scene.load(I+"shop.json",Laya.Handler.create(this,function(e){this.rootNode.addChild(e),e.zOrder=3}))}}let x,G="prefab/",M=27,R=0,B=92;class E extends Laya.Script{constructor(){super(),this.leaderData={},this.mode=0}onAwake(){this.owner.width=Laya.stage.width,this.owner.height=Laya.stage.height,this.owner.event(Laya.Event.RESIZE),this.backBtn.on(Laya.Event.CLICK,this,this.back),this.friendBtn.on(Laya.Event.CLICK,this,this.friend),this.worldBtn.on(Laya.Event.CLICK,this,this.world),this.inviteBtn.on(Laya.Event.CLICK,this,this.invite),0==o.inviteable()&&(this.friendBtn.visible=!1,this.worldBtn.visible=!1,this.inviteBtn.visible=!1),this.moneyText.text=h.getMoney(),r.requsetRankList(0,function(e){this.leaderData=e,Laya.loader.load(G+"top_item.json",Laya.Handler.create(this,this.onAssetLoaded))},this)}loadUserAvatar(e,t){e&&t&&Laya.loader.load(t,Laya.Handler.create(this,function(t){null!=t&&null!=t&&(e.source=t)}),void 0,Laya.Loader.IMAGE)}onAssetLoaded(e){if(this.pref=new Laya.Prefab,this.pref.json=e,this.pref&&this.leaderData){this.leaderData.me&&null!=this.leaderData.me?(this.meNode.getChildByName("text_top").text=this.leaderData.me,this.meNode.getChildByName("text_name").text=o.getUIDname(),this.meNode.getChildByName("text_score").text=t.highScore,this.loadUserAvatar(this.meNode.getChildByName("Image_avatar"),o.getUIDAvatarUrl()),this.meNode.visible=!0):this.meNode.visible=!1;for(var a=this.leaderData.users.length,i=0;i<a;i++){var s=this.leaderData.users[i],n=Laya.Pool.getItemByCreateFun("ItemPrefab",this.pref.create,this.pref),r=n.getChildByName("node_player");r.getChildByName("text_top").text=i+1,r.getChildByName("text_name").text=s.name,r.getChildByName("text_score").text=s.score1,this.loadUserAvatar(r.getChildByName("Image_avatar"),s.avatar),n.x=M,n.y=R+B*i+1,this.scrollView.addChild(n)}if(this.orgHeight=this.scrollView.height,this.scrollView.height<a*B){this.scrollView.height=a*B;var h=this.scrollView.height-this.orgHeight;x=new Laya.Rectangle(0,0-h,0,h),this.scrollView.on(Laya.Event.MOUSE_DOWN,this,this.onStartDrag)}}}back(){this.owner.destroy()}friend(){console.log(" friend ")}world(){console.log(" world ")}invite(){console.log(" invite ")}onStartDrag(e){this.scrollView.startDrag(x,!0,0)}}class P extends Laya.Script{constructor(){super()}onAwake(){this.owner.timerOnce(1500,this,this.remove)}setMoney(e){this.moneyText.text=e}remove(){this.owner.destroy()}}class T extends Laya.Script{constructor(){super()}onAwake(){this.owner.width=Laya.stage.width,this.owner.height=Laya.stage.height,this.owner.event(Laya.Event.RESIZE),this.musicBtn.selected=t.music>0,this.effectBtn.selected=t.sound>0,this.backBtn.on(Laya.Event.CLICK,this,this.back),this.musicBtn.on("change",this,this.music),this.effectBtn.on("change",this,this.effect)}back(){console.log(" play play "),this.owner.destroy()}music(){console.log(" music ",this.musicBtn.selected?"on":"off"),h.setMusicOn(this.musicBtn.selected)}effect(){console.log(" effect ",this.effectBtn.selected?"on":"off"),h.setSoundOn(this.effectBtn.selected)}}class H extends Laya.Script{constructor(){super()}onAwake(){this.owner.timerOnce(1e3,this,this.remove)}setTips(e){this.tipsText.text=e}remove(){this.owner.destroy()}}class F extends Laya.Script{constructor(){super()}onAwake(){this.owner.width=Laya.stage.width,this.owner.height=Laya.stage.height,this.owner.event(Laya.Event.RESIZE),this.buyBtn.on(Laya.Event.CLICK,this,this.buy),this.videoBtn.on(Laya.Event.CLICK,this,this.video),this.cancelBtn.on(Laya.Event.CLICK,this,this.cancel),this.pay=200+Math.floor(.4*h.cur_score),this.buyText.text=this.pay}buy(){console.log(" buy buy "),h.payMoney(this.pay)&&(this.owner.destroy(),Laya.stage.event("revival"))}video(){console.log(" video video "),this.owner.destroy(),Laya.stage.event("revival")}cancel(){this.owner.destroy(),Laya.stage.event("game_over")}}class N extends Laya.Script{constructor(){super()}onAwake(){this.owner.width=Laya.stage.width,this.owner.height=Laya.stage.height,this.owner.event(Laya.Event.RESIZE),this.cancelBtn.on(Laya.Event.CLICK,this,this.back),this.shareBtn.on(Laya.Event.CLICK,this,this.share)}back(){Laya.stage.event("share_done",!1),this.owner.destroy()}share(){o.shareVideo(this,this.shareEnd)||this.shareEnd(!1)}shareEnd(e){Laya.stage.event("share_done",e),e?Laya.stage.event("get_money",100):Laya.stage.event("tips","分享失败"),this.owner.destroy()}}let A="scenes/",U=250,V=192,K=344,O=400,z={Release:0,Press:1};class j extends Laya.Script{constructor(){super(),this.point=new Laya.Vector2,this.startPoint=new Laya.Vector2,this.lockTouch=!1,this.mouseState=z.Release,this.tl=null}onAwake(){this.owner.width=Laya.stage.width,this.owner.height=Laya.stage.height,this.owner.event(Laya.Event.RESIZE),this.backBtn.on(Laya.Event.CLICK,this,this.back),this.buyBtn.on(Laya.Event.CLICK,this,this.buy),this.replaceBtn.on(Laya.Event.CLICK,this,this.replace),Laya.loader.load("res/config/brick_skin_coin.csv",Laya.Handler.create(this,function(a){this.config_coin=e.analyze(a),h.setConfigForKey("brick_skin_coin",this.config_coin);t.skin.length;this.checkBuy()})),this.moneyText.text=t.money,this.createList()}createList(){var e=h.getConfigForKey("brick_skin");if(this.skin_config=e,e){for(var t=0;t<e.length;t++){var a=new Laya.Sprite;a.config=e[t],a.x=t*O+Laya.stage.width/2,a.y=K/2+U,a.pivotX=V/2,a.pivotY=K/2,a.loadImage("PiFu/"+a.config.shopRes+".png"),this.scrollView.addChild(a)}this.scrollView.width=e.length*O+Laya.stage.width,this.MAX_X=(e.length-1)*O,this.scrollView.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown),this.scrollView.on(Laya.Event.MOUSE_MOVE,this,this.onMouseMove),this.scrollView.on(Laya.Event.MOUSE_UP,this,this.onMouseUp),this.scrollView.frameLoop(1,this,this.onFrameLoop)}}back(){this.owner.destroy()}buyDone(){this.tl&&(this.tl.destroy(),this.tl=null),this.tl=new Laya.Animation,this.tl.loadAnimation(A+"anim_hezi_011.ani"),this.aniNode.addChild(this.tl),this.tl.play(0,!1),Laya.timer.once(1e3,this,this.animationDone)}animationDone(){this.tl&&(this.tl.destroy(),this.tl=null)}buy(){for(var e=[],a=0;a<this.skin_config.length;a++)1==this.skin_config[a].type&&0==this.checkSkin(this.skin_config[a].id)&&e.push(this.skin_config[a].id);var i=e[Math.floor(Math.random()*e.length)];if(this.config_coin.length>t.skin.length&&h.buySkin(i,this.config_coin[t.skin.length].coin)){this.moneyText.text=t.money;var s=i*O,o=500/(this.skin_config.length*O)*s;Laya.Tween.to(this.scrollView,{x:0-s},o,null,Laya.Handler.create(this,this.tweenEnd)),this.lockTouch=!0,this.buyDone()}}tweenEnd(){this.lockTouch=!1,this.onFocus()}replace(){this.focusNode&&this.focusNode.config&&(h.useSkin(this.focusNode.config.id),this.onFocus(),Laya.stage.event("change_skin"))}onMouseDown(e){0==this.lockTouch&&(this.mouseState=z.Press,this.idx=Math.floor(Math.abs(this.scrollView.x)/O),this.startPoint.x=Laya.stage.mouseX,this.startPoint.y=Laya.stage.mouseY,this.point.x=Laya.stage.mouseX,this.point.y=Laya.stage.mouseY)}onMouseMove(){this.mouseState==z.Press&&(this.scrollView.x+=Laya.stage.mouseX-this.point.x,this.scrollView.x>0?this.scrollView.x=0:0-this.scrollView.x>this.MAX_X&&(this.scrollView.x=0-this.MAX_X),this.point.x=Laya.stage.mouseX)}onMouseUp(){this.mouseState=z.Release,this.onFocus(Laya.stage.mouseX-this.startPoint.x)}checkSkin(e){for(var a=t.skin,i=0;i<a.length;i++)if(a[i]==e)return!0;return!1}checkBuy(){return t.skin.length<this.skin_config.length-1&&(this.needText.text=this.config_coin[t.skin.length].coin,!0)}onFocus(e){var a,i=Math.floor(Math.abs(this.scrollView.x)/O+.5);Math.abs(e)>=60&&Math.abs(e)<O/2&&i==this.idx&&(e>60?this.scrollView.x+=O/2:this.scrollView.x-=O/2);for(var s=9999,o=0;o<this.scrollView.numChildren;o++){var n=this.scrollView.getChildAt(o);(r=Math.abs(n.x+this.scrollView.x-Laya.stage.width/2))<s&&(a=n,s=r)}if(this.buyNode.visible=!1,this.useNode.visible=!1,this.lockNode.visible=!1,a){var r=a.x+this.scrollView.x-Laya.stage.width/2;this.scrollView.x-=r,this.focusNode=a,0==a.config.type?this.checkBuy()&&(this.buyNode.visible=!0):this.checkSkin(a.config.id)?t.cur_skin!=a.config.id&&(this.useNode.visible=!0):this.lockNode.visible=!0}this.lockTouch=!1}onFrameLoop(){for(var e=0;e<this.scrollView.numChildren;e++){var t=this.scrollView.getChildAt(e),a=t.x+this.scrollView.x;a>=240&&a<=480?t.scale(1.5,1.5):t.scale(1.2,1.2)}}}class Z{static init(){let e=Laya.ClassUtils.regClass;e("script/GameOverUI.js",c),e("script/Game.js",_),e("script/GameUI.js",C),e("script/PauseUI.js",D),e("script/LeaderboardUI.js",E),e("script/GetMoneyUI.js",P),e("script/HelpUI.js",T),e("script/TipsUI.js",H),e("script/RevivalUI.js",F),e("script/ShareVideoUI.js",N),e("script/ShopUI.js",j)}}Z.width=720,Z.height=1280,Z.scaleMode="showall",Z.screenMode="none",Z.alignV="middle",Z.alignH="center",Z.startScene="scenes/GameUI.scene",Z.sceneRoot="",Z.debug=!1,Z.stat=!1,Z.physicsDebug=!1,Z.exportSceneToJson=!0,Z.init();new class{constructor(){9*Laya.Browser.clientHeight/16>Laya.Browser.clientWidth&&(Z.height=Z.width*Laya.Browser.clientHeight/Laya.Browser.clientWidth,Z.height>1560&&(Z.height=1560)),window.Laya3D?Laya3D.init(Z.width,Z.height):Laya.init(Z.width,Z.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=Z.scaleMode,Laya.stage.screenMode=Z.screenMode,Laya.stage.alignV=Z.alignV,Laya.stage.alignH=Z.alignH,Laya.URL.exportSceneToJson=Z.exportSceneToJson,(Z.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),Z.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),Z.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION),"undefined"!=typeof tt?(console.log(" i am tt !!!"),Laya.URL.basePath="https://hotupdate.blackgate.club/hotupdate/brick/wxgame/"):"undefined"!=typeof wx?(console.log(" i am wx !!!"),Laya.URL.basePath="https://hotupdate.blackgate.club/hotupdate/brick/wxgame/"):console.log(" not mini game !!!"),console.log("GameConfig ",Z.width,Z.height)}onVersionLoaded(){r.login(),Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){Z.startScene&&Laya.Scene.open(Z.startScene)}}}();